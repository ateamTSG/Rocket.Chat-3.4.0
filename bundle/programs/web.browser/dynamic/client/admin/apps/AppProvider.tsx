function module(e,t,n){let r,a,s,l,i,o,c,d,p;n.link("@babel/runtime/helpers/objectSpread2",{default(e){r=e}},0),n.export({AppDataContext:()=>u}),n.link("react",{default(e){a=e},createContext(e){s=e},useEffect(e){l=e},useRef(e){i=e},useState(e){o=e}},0),n.link("../../../app/apps/client/orchestrator",{Apps(e){c=e}},1),n.link("../../../app/apps/client/communication",{AppEvents(e){d=e}},2),n.link("./helpers",{handleAPIError(e){p=e}},3);const u=s({data:[],dataCache:[]}),m=e=>{const t=Object.entries(e);for(const[r,a]of t){var n;null===(n=c.getWsListener())||void 0===n||n.registerListener(d[r],a)}return()=>{for(const[n,r]of t){var e;null===(e=c.getWsListener())||void 0===e||e.unregisterListener(d[n],r)}}},v=e=>{let{children:t}=e;const[n,s]=o(()=>[]),[d,v]=o(()=>[]),A=i(n);A.current=n;const f=()=>{v(()=>[])},P=()=>A.current.slice(0);return l(()=>{const e=async e=>{try{const{status:t,version:n}=await c.getApp(e),a=await c.getAppFromMarketplace(e,n),l=P(),i=l.findIndex(t=>{let{id:n}=t;return n===e});l[i]=r({},a,{installed:!0,status:t,version:n,marketplaceVersion:a.version}),s(l),f()}catch(t){p(t)}},t={APP_ADDED:e,APP_UPDATED:e,APP_REMOVED:e=>{const t=P(),n=t.findIndex(t=>{let{id:n}=t;return n===e});t[n]&&(!1!==t[n].marketplace?t.splice(n,1):(delete t[n].installed,delete t[n].status,t[n].version=t[n].marketplaceVersion),s(t),f())},APP_STATUS_CHANGE:e=>{let{appId:t,status:n}=e;const r=P(),a=r.find(e=>{let{id:n}=e;return n===t});a&&(a.status=n,s(r),f())},APP_SETTING_UPDATED:()=>{f()}},n=m(t);return(async()=>{try{const[e,t]=await Promise.all([c.getAppsFromMarketplace(),c.getApps()]),n=e.map(e=>{const n=t.findIndex(t=>{let{id:n}=t;return n===e.id});if(!t[n])return r({},e,{status:void 0,marketplaceVersion:e.version,bundledIn:e.bundledIn});const a=t.splice(n,1).pop();return r({},e,{installed:!0,status:null==a?void 0:a.status,version:null==a?void 0:a.version,bundledIn:e.bundledIn,marketplaceVersion:e.version})});t.length&&n.push(...t.map(e=>r({},e,{installed:!0,marketplace:!1}))),s(n.sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1)),f()}catch(e){p(e),n()}})(),n},[]),a.createElement(u.Provider,{children:t,value:{data:n,dataCache:d}})};n.exportDefault(v)}

