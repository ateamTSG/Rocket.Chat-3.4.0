function module(e,t,a){let n,s,i,l,r,o,g,c,m,h,d,f,p,u,v;a.link("@babel/runtime/helpers/objectSpread2",{default(e){n=e}},0),a.link("meteor/meteor",{Meteor(e){s=e}},0),a.link("meteor/reactive-var",{ReactiveVar(e){i=e}},1),a.link("meteor/kadira:flow-router",{FlowRouter(e){l=e}},2),a.link("meteor/templating",{Template(e){r=e}},3),a.link("underscore",{default(e){o=e}},4),a.link("toastr",{default(e){g=e}},5),a.link("../../../../ui-utils",{TabBar(e){c=e},RocketChatTabBar(e){m=e}},6),a.link("../../../../utils",{t(e){h=e},handleError(e){d=e}},7),a.link("../../../../authorization",{hasPermission(e){f=e}},8),a.link("./customTemplates/register",{getCustomFormTemplate(e){p=e}},9),a.link("./livechatDepartmentForm.html"),a.link("../../../../utils/client",{APIClient(e){u=e},roomTypes(e){v=e}},10),r.livechatDepartmentForm.helpers({department:()=>r.instance().department.get(),agents:()=>r.instance().department&&!o.isEmpty(r.instance().department.get())?r.instance().department.get().agents:[],departmentAgents:()=>o.sortBy(r.instance().departmentAgents.get(),"username"),showOnRegistration(e){const t=r.instance().department.get();return t.showOnRegistration===e||void 0===t.showOnRegistration&&!0===e},showOnOfflineForm(e){const t=r.instance().department.get();return t.showOnOfflineForm===e||void 0===t.showOnOfflineForm&&!0===e},requestTagBeforeClosingChat(){const e=r.instance().department.get();return!(!e||!e.requestTagBeforeClosingChat)},customFieldsTemplate:()=>p("livechatDepartmentForm"),data:()=>({id:l.getParam("_id")}),exceptionsAgents:()=>o.pluck(r.instance().departmentAgents.get(),"username"),agentModifier:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const a=e.get();return"@".concat(0===a.length?t:t.replace(new RegExp(e.get()),e=>"<strong>".concat(e,"</strong>")))}),agentConditions:()=>({roles:"livechat-agent"}),onSelectAgents:()=>r.instance().onSelectAgents,selectedAgents:()=>r.instance().selectedAgents.get(),onClickTagAgents:()=>r.instance().onClickTagAgents,flexData:()=>({tabBar:r.instance().tabBar,data:r.instance().tabBarData.get()}),tabBarVisible:()=>Object.values(c.buttons.get()).some(e=>e.groups.some(e=>e.startsWith("livechat-department"))),chatClosingTags:()=>r.instance().chatClosingTags.get(),availableDepartmentTags:()=>r.instance().availableDepartmentTags.get(),hasAvailableTags:()=>[...r.instance().availableTags.get()].length>0,hasChatClosingTags:()=>[...r.instance().chatClosingTags.get()].length>0,onClickTagOfflineMessageChannel:()=>r.instance().onClickTagOfflineMessageChannel,selectedOfflineMessageChannel:()=>r.instance().offlineMessageChannel.get(),onSelectOfflineMessageChannel:()=>r.instance().onSelectOfflineMessageChannel,offlineMessageChannelModifier:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const a=e.get();return"#".concat(0===a.length?t:t.replace(new RegExp(e.get()),e=>"<strong>".concat(e,"</strong>")))}),channelSelector:()=>e=>({name:e})}),r.livechatDepartmentForm.events({"submit #department-form"(e,t){e.preventDefault();const a=t.$("button.save");let n;const i=$(e.currentTarget).data("id");if(f("manage-livechat-departments")){const e=t.$("input[name=enabled]:checked").val(),a=t.$("input[name=name]").val(),s=t.$("textarea[name=description]").val(),i=t.$("input[name=showOnRegistration]:checked").val(),l=t.$("input[name=email]").val(),r=t.$("input[name=showOnOfflineForm]:checked").val(),o=t.$("input[name=requestTagBeforeClosingChat]:checked").val(),c=t.chatClosingTags.get(),[m]=t.offlineMessageChannel.get(),d=m&&v.getRoomName(m.t,m)||"";if("1"!==e&&"0"!==e)return g.error(h("Please_select_enabled_yes_or_no"));if(""===a.trim())return g.error(h("Please_fill_a_name"));if(""===l.trim()&&"1"===r)return g.error(h("Please_fill_an_email"));n={enabled:"1"===e,name:a.trim(),description:s.trim(),showOnRegistration:"1"===i,showOnOfflineForm:"1"===r,requestTagBeforeClosingChat:"1"===o,email:l.trim(),chatClosingTags:c,offlineMessageChannelName:d}}const r=a.html();a.html(h("Saving")),t.$(".customFormField").each((e,a)=>{const s=t.$(a),i=s.attr("name");n[i]=s.val()});const o=[];t.departmentAgents.get().forEach(e=>{e.count=t.$(".count-".concat(e.agentId)).val(),e.order=t.$(".order-".concat(e.agentId)).val(),o.push(e)});const c=e=>{if(a.html(r),e)return d(e);g.success(h("Saved")),l.go("livechat-departments")};if(f("manage-livechat-departments"))s.call("livechat:saveDepartment",i,n,o,c);else{if(!f("add-livechat-department-agents"))throw new Error(h("error-not-authorized"));s.call("livechat:saveDepartmentAgents",i,o,c)}},"click .add-agent"(e,t){e.preventDefault();const a=t.selectedAgents.get();a.forEach(async e=>{const{_id:a,username:n}=e,s=t.departmentAgents.get();if(s.find(e=>{let{agentId:t}=e;return t===a}))return g.error(h("This_agent_was_already_selected"));const i=o.clone(e);i.agentId=a,delete i._id,s.push(i),t.departmentAgents.set(s),t.selectedAgents.set(t.selectedAgents.get().filter(e=>e.username!==n))})},"click button.back"(e){e.preventDefault(),l.go("livechat-departments")},"click .remove-agent"(e,t){e.preventDefault(),t.departmentAgents.set(t.departmentAgents.get().filter(e=>e.agentId!==this.agentId))},"click #addTag"(e,t){e.stopPropagation(),e.preventDefault();const a=[...t.availableTags.get()].length>0,n=a?"#tagSelect":"#tagInput",s=a?"placeholder":"",i=$(n).val(),l=[...t.chatClosingTags.get()];""===i||l.indexOf(i)>-1||(l.push(i),t.chatClosingTags.set(l),$(n).val(s))},"click .remove-tag"(e,t){e.stopPropagation(),e.preventDefault();const a=[...t.chatClosingTags.get()].filter(e=>e!==this.valueOf());t.chatClosingTags.set(a)}}),r.livechatDepartmentForm.onCreated((async function(){this.department=new i({enabled:!0}),this.departmentAgents=new i([]),this.selectedAgents=new i([]),this.tabBar=new m,this.tabBar.showGroup(l.current().route.name),this.tabBarData=new i,this.chatClosingTags=new i([]),this.availableTags=new i([]),this.availableDepartmentTags=new i([]),this.offlineMessageChannel=new i([]),this.onClickTagOfflineMessageChannel=()=>{this.offlineMessageChannel.set([])},this.onSelectOfflineMessageChannel=async e=>{let{item:t}=e;const{room:a}=await u.v1.get("rooms.info?roomId=".concat(t._id));a.text=a.name,this.offlineMessageChannel.set([a])},this.onSelectAgents=e=>{let{item:t}=e;this.selectedAgents.set([t])},this.onClickTagAgents=e=>{let{username:t}=e;this.selectedAgents.set(this.selectedAgents.get().filter(e=>e.username!==t))},this.loadAvailableTags=e=>{s.call("livechat:getTagsList",(t,a)=>{this.availableTags.set(a||[]);const n=this.availableTags.get(),s=n.filter(t=>{let{departments:a}=t;return 0===a.length||a.indexOf(e)>-1}).map(e=>{let{name:t}=e;return t});this.availableDepartmentTags.set(s)})},this.autorun(async()=>{const e=l.getParam("_id");if(e){const{department:t,agents:a=[]}=await u.v1.get("livechat/department/".concat(l.getParam("_id")));this.department.set(t),this.departmentAgents.set(a),this.chatClosingTags.set(t&&t.chatClosingTags||[]),this.loadAvailableTags(e)}}),this.autorun(async()=>{const e=this.department.get();let t=[];if(null==e?void 0:e.offlineMessageChannelName){const{room:a}=await u.v1.get("rooms.info?roomName=".concat(null==e?void 0:e.offlineMessageChannelName));a&&(a.text=a.name,t=[n({},a)])}this.offlineMessageChannel.set(t)})}))}

