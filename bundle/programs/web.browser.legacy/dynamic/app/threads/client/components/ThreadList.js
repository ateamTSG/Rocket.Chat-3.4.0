function module(e,n,t){var r,i,o,u,a,c,l,s,d,f,m,p,g,h,k,x,v,E,b,T,_,w,S,C,I,y,D,M,L,U,z,R,B,F,G,A,N,O,P,j,H,$,V,W,q;function J(){var e=a(["\n\t\tcursor: pointer;\n\t\tborder-bottom: 2px solid #F2F3F5 !important;\n\n\t\t&:hover,\n\t\t&:focus {\n\t\t\tbackground: #F7F8FA;\n\t\t}\n\t"]);return J=function(){return e},e}function K(e){var n=y(J());return function(t){return d.createElement(e,u({className:n,tabIndex:0},t))}}function Q(e){return function(n){var t=n.msg,r=n.username,i=n.replies,a=n.tcount,c=n.ts,l=o(n,["msg","username","replies","tcount","ts"]);return(d.createElement(e,u({replies:a,participants:i.length,username:r,msg:t,ts:c},l)))}}t.link("@babel/runtime/helpers/slicedToArray",{default:function(e){r=e}},0),t.link("@babel/runtime/helpers/objectSpread2",{default:function(e){i=e}},1),t.link("@babel/runtime/helpers/objectWithoutProperties",{default:function(e){o=e}},2),t.link("@babel/runtime/helpers/extends",{default:function(e){u=e}},3),t.link("@babel/runtime/helpers/taggedTemplateLiteralLoose",{default:function(e){a=e}},4),t.export({withData:function(){return re},normalizeThreadMessage:function(){return oe},ThreadList:function(){return ue}}),t.link("meteor/mongo",{Mongo:function(e){c=e}},0),t.link("meteor/tracker",{Tracker:function(e){l=e}},1),t.link("underscore.string",{default:function(e){s=e}},2),t.link("react",{default:function(e){d=e},useCallback:function(e){f=e},useMemo:function(e){m=e},useState:function(e){p=e},useEffect:function(e){g=e},useRef:function(e){h=e}},3),t.link("@rocket.chat/fuselage",{Box:function(e){k=e},Icon:function(e){x=e},TextInput:function(e){v=e},Select:function(e){E=e},Margins:function(e){b=e},Callout:function(e){T=e}},4),t.link("react-window",{FixedSizeList:function(e){_=e}},5),t.link("react-window-infinite-loader",{default:function(e){w=e}},6),t.link("@rocket.chat/fuselage-hooks",{useDebouncedValue:function(e){S=e},useDebouncedState:function(e){C=e},useResizeObserver:function(e){I=e}},7),t.link("@rocket.chat/css-in-js",{css:function(e){y=e}},8),t.link("../../../../client/components/basic/VerticalBar",{default:function(e){D=e}},9),t.link("../../../../client/contexts/TranslationContext",{useTranslation:function(e){M=e}},10),t.link("../../../../client/components/basic/RawText",{default:function(e){L=e}},11),t.link("../../../../client/contexts/RouterContext",{useRoute:function(e){U=e}},12),t.link("../../../utils/client",{roomTypes:function(e){z=e}},13),t.link("../../../ui-utils/client",{call:function(e){R=e},renderMessageBody:function(e){B=e}},14),t.link("../../../../client/contexts/UserContext",{useUserId:function(e){F=e}},15),t.link("../../../models/client",{Messages:function(e){G=e}},16),t.link("../../../../client/hooks/useEndpointDataExperimental",{useEndpointDataExperimental:function(e){A=e},ENDPOINT_STATES:function(e){N=e}},17),t.link("../../../ui-utils/client/config",{getConfig:function(e){O=e}},18),t.link("../../../../client/hooks/useTimeAgo",{useTimeAgo:function(e){P=e}},19),t.link("./ThreadListMessage",{default:function(e){j=e},MessageSkeleton:function(e){H=e}},20),t.link("./hooks/useUserSubscription",{useUserSubscription:function(e){$=e}},21),t.link("./hooks/useUserRoom",{useUserRoom:function(e){V=e}},22),t.link("./hooks/useLocalstorage",{useLocalStorage:function(e){W=e}},23),t.link("../../../../client/contexts/SettingsContext",{useSetting:function(e){q=e}},24);var X=d.memo(Q(K(j))),Y=d.memo(K(H)),Z=parseInt(O("threadsListSize"))||25,ee=function(e){var n=e.msg,t=e.u,r=e.replies,o=e.mentions,u=e.tcount,a=e.ts,c=e._id,l=e.tlm,s=e.attachments;return i({},c&&{_id:c},{attachments:s,mentions:o,msg:n,u:t,replies:r,tcount:u,ts:new Date(a),tlm:new Date(l)})},ne={tunread:1,tunreadUser:1,tunreadGroup:1},te={t:1,name:1};function re(e){return function(n){var t=n.rid,a=o(n,["rid"]),s=V(t,te),k=$(t,ne),x=F(),v=W("thread-list-type","all"),E=r(v,2),b=E[0],T=E[1],_=p(""),w=r(_,2),I=w[0],y=w[1],D=p(Z),M=r(D,2),L=M[0],U=M[1],z=C([],100),R=r(z,2),B=R[0],O=R[1],P=h(new c.Collection(null)),j=h(),H=p({skip:0,count:Z}),q=r(H,2),J=q[0],K=q[1],Q=m((function(){return{rid:s._id,count:J.count,offset:J.skip,type:b,text:I}}),[s._id,J.skip,J.count,b,I]),X=A("chat.getThreadsList",S(Q,400)),Y=X.data,re=X.state,ie=X.error,oe=f((function(e,n){return K({skip:e,count:n-e}),new Promise((function(e){j.current=e}))}),[]);g((function(){return function(){return P.current.remove({},(function(){}))}}),[I,b]),g((function(){re===N.DONE&&Y&&Y.threads&&(Y.threads.forEach((function(e){var n=e._id,t=o(e,["_id"]);P.current.upsert({_id:n},ee(t))})),j.current&&j.current(),U(Y.total))}),[Y,re]),g((function(){var e=G.find({rid:s._id,tcount:{$exists:!0},_hidden:{$ne:!0}}).observe({added:function(e){var n=e._id,t=o(e,["_id"]);P.current.upsert({_id:n},t)},changed:function(e){var n=e._id,t=o(e,["_id"]);P.current.update({_id:n},t)},removed:function(e){var n=e._id;P.current.remove(n)}});return function(){return e.stop()}}),[s._id]),g((function(){var e=l.autorun((function(){var e=i({},"subscribed"===b&&{replies:{$in:[x]}});O(P.current.find(e,{sort:{tlm:-1}}).fetch().map(ee))}));return function(){return e.stop()}}),[s._id,b,O,x]);var ue=f((function(e){K({skip:0,count:Z}),y(e.currentTarget.value)}),[]);return(d.createElement(e,u({},a,{unread:null==k?void 0:k.tunread,unreadUser:null==k?void 0:k.tunreadUser,unreadGroup:null==k?void 0:k.tunreadGroup,userId:x,error:ie,threads:B,total:L,loading:re===N.LOADING,loadMoreItems:oe,room:s,text:I,setText:ue,type:b,setType:T})))}}var ie=function(e){e.preventDefault(),e.stopPropagation(),R([!0,"true"].includes(e.currentTarget.dataset.following)?"unfollowMessage":"followMessage",{mid:e.currentTarget.dataset.id})},oe=function(e){var n=u({},e);if(n.msg)return B(n).replace(/<br\s?\\?>/g," ");if(n.attachments){var t=n.attachments.find((function(e){return e.title||e.description}));if(t&&t.description)return s.escapeHTML(t.description);if(t&&t.title)return s.escapeHTML(t.title)}};function ue(e){var n=e.total,t=void 0===n?10:n,r=e.threads,i=void 0===r?[]:r,o=e.room,a=e.unread,c=void 0===a?[]:a,l=e.unreadUser,s=void 0===l?[]:l,p=e.unreadGroup,g=void 0===p?[]:p,S=e.type,C=e.setType,y=e.loadMoreItems,R=e.loading,B=e.onClose,F=e.error,G=e.userId,A=e.text,N=e.setText,O=q("UI_Use_Real_Name"),j=h(),H=M(),$=U(z.getConfig(o.t).route.name),V=f((function(e){var n=e.currentTarget.dataset.id;$.push({tab:"thread",context:n,rid:o._id,name:o.name})}),[o._id,o.name]),W=P(),J=m((function(){return[["all",H("All")],["following",H("Following")],["unread",H("Unread")]]}),[]);j.current=i;var K=f(d.memo(function(){function e(e){var n=e.data,t=e.index,r=e.style;if(!n[t])return d.createElement(Y,{style:r});var i=n[t],o=oe(i),a=i.u.name,l=void 0===a?i.u.username:a;return d.createElement(X,u({},i,{name:O?l:i.u.username,username:i.u.username,style:r,unread:c.includes(i._id),mention:s.includes(i._id),all:g.includes(i._id),following:i.replies&&i.replies.includes(G),"data-id":i._id,msg:o,t:H,formatDate:W,handleFollowButton:ie,onClick:V}))}return e}()),[c,s,g,O]),Q=f((function(e){return e<j.current.length}),[]),ee=I(),ne=ee.ref,te=ee.contentBoxSize,re=(te=void 0===te?{}:te).inlineSize,ue=void 0===re?378:re,ae=te.blockSize,ce=void 0===ae?750:ae;return d.createElement(D,null,d.createElement(D.Header,null,d.createElement(x,{name:"thread",size:"x20"}),d.createElement(k,{flexShrink:1,flexGrow:1,withTruncatedText:!0,mi:"x8"},d.createElement(L,null,H("Threads"))),d.createElement(D.Close,{onClick:B})),d.createElement(D.Content,{paddingInline:0},d.createElement(k,{display:"flex",flexDirection:"row",p:"x24",borderBlockEndWidth:"x2",borderBlockEndStyle:"solid",borderBlockEndColor:"neutral-200"},d.createElement(k,{display:"flex",flexDirection:"row",flexGrow:1,mi:"neg-x8"},d.createElement(b,{inline:"x8"},d.createElement(v,{placeholder:H("Search_Messages"),value:A,onChange:N,addon:d.createElement(x,{name:"magnifier",size:"x20"})}),d.createElement(E,{flexGrow:0,width:"110px",onChange:C,value:S,options:J})))),d.createElement(k,{flexGrow:1,flexShrink:1,ref:ne},F&&d.createElement(T,{mi:"x24",type:"danger"},F.toString()),0===t&&d.createElement(k,{p:"x24"},H("No_Threads")),d.createElement(w,{isItemLoaded:Q,itemCount:t,loadMoreItems:R?function(){}:y},(function(e){var n=e.onItemsRendered,r=e.ref;return(d.createElement(_,{height:ce,width:ue,itemCount:t,itemData:i,itemSize:124,ref:r,minimumBatchSize:Z,onItemsRendered:n},K))})))))}t.exportDefault(re(ue))}

