{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:mongo-config/server/index.js"],"names":["_objectSpread","module","link","default","v","tls","PassThrough","EmailTest","Mongo","DEFAULT_ECDH_CURVE","mongoConnectionOptions","process","env","MONGO_URL","includes","retryWrites","mongoOptionStr","MONGO_OPTIONS","mongoOptions","JSON","parse","Object","assign","keys","length","setConnectionOptions","HTTP_FORWARDED_COUNT","NODE_ENV","TEST_MODE","stream","overrideOutputStream","on"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,IAAIA,aAAJ;;AAAkBC,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACC,SAAO,CAACC,CAAD,EAAG;AAACJ,iBAAa,GAACI,CAAd;AAAgB;;AAA5B,CAAnD,EAAiF,CAAjF;AAAlB,IAAIC,GAAJ;AAAQJ,MAAM,CAACC,IAAP,CAAY,KAAZ,EAAkB;AAACC,SAAO,CAACC,CAAD,EAAG;AAACC,OAAG,GAACD,CAAJ;AAAM;;AAAlB,CAAlB,EAAsC,CAAtC;AAAyC,IAAIE,WAAJ;AAAgBL,MAAM,CAACC,IAAP,CAAY,QAAZ,EAAqB;AAACI,aAAW,CAACF,CAAD,EAAG;AAACE,eAAW,GAACF,CAAZ;AAAc;;AAA9B,CAArB,EAAqD,CAArD;AAAwD,IAAIG,SAAJ;AAAcN,MAAM,CAACC,IAAP,CAAY,cAAZ,EAA2B;AAACK,WAAS,CAACH,CAAD,EAAG;AAACG,aAAS,GAACH,CAAV;AAAY;;AAA1B,CAA3B,EAAuD,CAAvD;AAA0D,IAAII,KAAJ;AAAUP,MAAM,CAACC,IAAP,CAAY,cAAZ,EAA2B;AAACM,OAAK,CAACJ,CAAD,EAAG;AAACI,SAAK,GAACJ,CAAN;AAAQ;;AAAlB,CAA3B,EAA+C,CAA/C;AAM3M;AACA;AACA;AACA;AACA;AACAC,GAAG,CAACI,kBAAJ,GAAyB,MAAzB;;AAEA,MAAMC,sBAAsB,qBAExB,CAACC,OAAO,CAACC,GAAR,CAAYC,SAAZ,CAAsBC,QAAtB,CAA+B,aAA/B,CAAD,IAAkD;AAAEC,aAAW,EAAE;AAAf,CAF1B,CAA5B;;AAKA,MAAMC,cAAc,GAAGL,OAAO,CAACC,GAAR,CAAYK,aAAnC;;AACA,IAAI,OAAOD,cAAP,KAA0B,WAA9B,EAA2C;AAC1C,QAAME,YAAY,GAAGC,IAAI,CAACC,KAAL,CAAWJ,cAAX,CAArB;AAEAK,QAAM,CAACC,MAAP,CAAcZ,sBAAd,EAAsCQ,YAAtC;AACA;;AAED,IAAIG,MAAM,CAACE,IAAP,CAAYb,sBAAZ,EAAoCc,MAApC,GAA6C,CAAjD,EAAoD;AACnDhB,OAAK,CAACiB,oBAAN,CAA2Bf,sBAA3B;AACA;;AAEDC,OAAO,CAACC,GAAR,CAAYc,oBAAZ,GAAmCf,OAAO,CAACC,GAAR,CAAYc,oBAAZ,IAAoC,GAAvE,C,CAEA;;AACA,IAAIf,OAAO,CAACC,GAAR,CAAYe,QAAZ,KAAyB,aAAzB,IAA0ChB,OAAO,CAACC,GAAR,CAAYgB,SAA1D,EAAqE;AACpE,QAAMC,MAAM,GAAG,IAAIvB,WAAJ,EAAf;AACAC,WAAS,CAACuB,oBAAV,CAA+BD,MAA/B;AACAA,QAAM,CAACE,EAAP,CAAU,MAAV,EAAkB,MAAM,CAAE,CAA1B;AACAF,QAAM,CAACE,EAAP,CAAU,KAAV,EAAiB,MAAM,CAAE,CAAzB;AACA,C","file":"/packages/rocketchat_mongo-config.js","sourcesContent":["import tls from 'tls';\nimport { PassThrough } from 'stream';\n\nimport { EmailTest } from 'meteor/email';\nimport { Mongo } from 'meteor/mongo';\n\n// FIX For TLS error see more here https://github.com/RocketChat/Rocket.Chat/issues/9316\n// TODO: Remove after NodeJS fix it, more information\n// https://github.com/nodejs/node/issues/16196\n// https://github.com/nodejs/node/pull/16853\n// This is fixed in Node 10, but this supports LTS versions\ntls.DEFAULT_ECDH_CURVE = 'auto';\n\nconst mongoConnectionOptions = {\n\t// add retryWrites=false if not present in MONGO_URL\n\t...!process.env.MONGO_URL.includes('retryWrites') && { retryWrites: false },\n};\n\nconst mongoOptionStr = process.env.MONGO_OPTIONS;\nif (typeof mongoOptionStr !== 'undefined') {\n\tconst mongoOptions = JSON.parse(mongoOptionStr);\n\n\tObject.assign(mongoConnectionOptions, mongoOptions);\n}\n\nif (Object.keys(mongoConnectionOptions).length > 0) {\n\tMongo.setConnectionOptions(mongoConnectionOptions);\n}\n\nprocess.env.HTTP_FORWARDED_COUNT = process.env.HTTP_FORWARDED_COUNT || '1';\n\n// Send emails to a \"fake\" stream instead of print them in console\nif (process.env.NODE_ENV !== 'development' || process.env.TEST_MODE) {\n\tconst stream = new PassThrough();\n\tEmailTest.overrideOutputStream(stream);\n\tstream.on('data', () => {});\n\tstream.on('end', () => {});\n}\n"]}